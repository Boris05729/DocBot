# DocBot
## Техническое задание на разработку Телеграм бота для регистрации и хранения документов ##
### Общее описание проекта ###
Проект заключается в разработке набора скриптов для взаимодействия с Телеграм ботом, который предназначен для регистрации и хранения входящих, исходящих и внутренних документов. Бот предоставляет возможность автоматизированной обработки документов с помощью интервью с пользователями и регистрации документов в соответствующих журналах.
Основные характеристики:
- Операционная система: Debian
- Язык программирования: BASH
- Назначение: Телеграм бот для регистрации и хранения документов
- Серверная часть: Легкий дистрибутив Debian, разворачиваемый на облачной виртуальной машине с предустановленными зависимостями и скриптами
- Бэкенд: Набор BASH скриптов, каждый скрипт выполняет одну функцию
- Журнал регистрации документов: HTML страницы для журналов входящих, исходящих и внутренних документов
Бекенд (серверная часть)
Серверная часть разработана на базе облегченного дистрибутива Debian, который разворачивается на облачной виртуальной машине. Предустановлены все необходимые зависимости для работы с Телеграм ботом. Бот реализован на языке BASH, а взаимодействие с Телеграм API осуществляется через отдельные скрипты. Каждая функция бота реализована отдельным скриптом, каждый из которых подробно описан ниже.
Перечень функций (скриптов)
●	/help – Справка
●	Описание: Команда выводит справку с детальной информацией по работе с ботом. Для каждой группы пользователей предусмотрена своя версия справки, текст которой хранится в файле manual_USERNAME.
●	Использование: Пользователь отправляет команду /help, бот проверяет группу пользователя и возвращает соответствующую справку.
●	/get_No – Получить исходящий номер
●	Описание: Команда выдает следующий свободный номер для исходящих документов, который может быть использован для регистрации документов.
●	Использование: Пользователь отправляет команду /get_No, бот выдает номер, который сохраняется в журнале исходящих документов.
●	Событие: отправка документа (pdf или JPEG)
●	Описание: При отправке файла бот инициирует интервью с пользователем для сбора информации о документе. Вопросы и ответы для интервью берутся из файла конфигурации structure.conf.
●	Использование: Пользователь отправляет файл, бот задает вопросы о типе документа, проекте и комментарии, после чего документ сохраняется в соответствующем каталоге.
●	Обработка входящих документов
●	Описание: Бот автоматически присваивает порядковый номер входящему документу, сохраняет его и регистрирует в журнале входящих документов.
●	Использование: Документ сохраняется в папке "Входящие" и записывается в журнал с уникальным номером.
●	Обработка исходящих/внутренних документов
●	Описание: Пользователь может зарегистрировать исходящий документ с зарезервированным номером, который сохранится в соответствующей директории и журнале исходящих или внутренних документов.
●	Использование: Пользователь отправляет документ, указывает номер и регистрирует его.
●	/journal – Просмотр журнала
●	Описание: Команда выводит журнал с данными о входящих, исходящих и внутренних документах.
●	Использование: Команда /journal выводит HTML страницу с журналом документов.
Фронтенд (пользовательская часть)
Интерфейс пользователя представлен через Телеграм, где все взаимодействие осуществляется с помощью команд, переданных боту. Команды и ответы строятся на основе файлов конфигурации, хранящихся на сервере. Пользовательские группы имеют разные привилегии и получают доступ к разным функциям бота. Также для просмотра и управления документами используется HTML интерфейс с журналами документов.
Пошаговая инструкция по использованию
1. Подключение к серверу. На облачной виртуальной машине разворачивается облегченный дистрибутив Debian с предустановленным Телеграм ботом и зависимостями.
2. Настройка файлов конфигурации. В папках /etc/ хранятся файлы с токенами, пользователями и структурой, которые нужно настроить перед использованием бота.
3. Запуск скриптов. Для выполнения каждой функции используется отдельный скрипт, который запускается в зависимости от команды пользователя (например, /get_No).
4. Обработка файлов и регистрация. Бот автоматически регистрирует входящие и исходящие документы в журналах, сохраняя их на сервере.
5. Использование журналов. Пользователи могут запрашивать журналы с помощью команды /journal и получать HTML страницы с данными.
/help – Справка (Расширенное описание)
Дополненное описание: Команда предназначена для вызова справочной информации, специфичной для каждого пользователя, в зависимости от его группы. Текст справки для каждой группы пользователей хранится в файле manual_USERNAME. Это позволяет предоставлять персонализированную информацию для каждой группы, например, инструкции для бухгалтерии, команды Техцентра и т.д.
Дополнительные возможности:
●	- Возможность обновления справки в реальном времени при изменениях в manual_USERNAME.
●	- Поддержка различных языков для мультиязычных групп пользователей.
/get_No – Получить исходящий номер (Расширенное описание)
Дополненное описание: Скрипт генерирует и возвращает следующий свободный исходящий номер для документа. Номер фиксируется в журнале и резервируется за пользователем для последующего использования при регистрации документа. Это позволяет отслеживать все исходящие документы.
Дополнительные возможности:
●	- Автоматическая проверка зарезервированных номеров для каждого пользователя.
●	- Возможность восстановления предыдущих номеров в случае ошибок или отмены операции.
Событие: отправка документа (pdf или JPEG) (Расширенное описание)
Дополненное описание: Этот скрипт отвечает за обработку всех загружаемых документов в формате PDF или JPEG. Бот инициирует диалог с пользователем, задавая серию вопросов на основе структуры, заданной в файле structure.conf. Это позволяет корректно классифицировать документы и сохранять их в соответствующих папках.
Дополнительные возможности:
●	- Поддержка других форматов файлов, таких как DOCX, XLSX.
●	- Автоматическое преобразование изображений в PDF для унификации форматов документов.
Обработка входящих документов (Расширенное описание)
Дополненное описание: Скрипт автоматически присваивает порядковый номер входящему документу, который затем сохраняется на сервере. Информация о документе фиксируется в журнале входящих документов, включая данные о пользователе, который загрузил документ.
Дополнительные возможности:
●	- Уведомление о получении нового документа для ответственных лиц.
●	- Возможность ручного редактирования записи о документе для внесения изменений.
Обработка исходящих/внутренних документов (Расширенное описание)
Дополненное описание: Пользователь может зарегистрировать исходящий или внутренний документ с использованием ранее полученного зарезервированного номера. Скрипт проверяет наличие свободных номеров, если пользователю нужно зарезервировать новый номер для документа.
Дополнительные возможности:
●	- Возможность пакетной загрузки и регистрации нескольких документов одновременно.
●	- Поддержка подписания исходящих документов цифровыми подписями.
/journal – Просмотр журнала (Расширенное описание)
Дополненное описание: Скрипт выводит журнал регистрации всех документов в формате HTML. В журнале отображаются входящие, исходящие и внутренние документы с полной информацией: номер документа, дата, имя пользователя, ссылка на документ, комментарий и статус обработки.
Дополнительные возможности:
●	- Возможность экспорта журнала в Excel или PDF для архивирования.
●	- Фильтрация документов по типу (входящие, исходящие, внутренние), дате и ответственным лицам.







Интеграция, конфигурация и структура системы для реализации документооборота через Телеграм бот и Госключ
1. Интеграция с системой Госключ 
Интеграция с системой Госключ должна включать не только передачу документов, но и реализацию полноценного процесса авторизации через API Госключа. Подробности включают:
- Этапы аутентификации: получение токена с использованием клиентских ключей и его последующее использование для взаимодействия с Госключом.
- Возможность обработки ошибок аутентификации, таких как просроченные токены, ошибки связи с сервером и т.д.
- Взаимодействие с внутренними документами через Госключ: отправка запросов на подтверждение, получение статусов обработки документов, их сохранение в локальной системе.
- Обязательная проверка подлинности всех отправляемых и получаемых документов с использованием сертификатов ЭЦП (электронной цифровой подписи).
- Информация о журналировании всех взаимодействий с Госключем для последующего аудита и безопасности.
2. Перечень файлов конфигурации и структура каталогов первого приближения
Конфигурационные файлы должны быть распределены по различным каталогам, обеспечивая логическую структуру системы.
- Основные файлы конфигурации:
  - **config.yaml**: основной конфигурационный файл, содержащий параметры для взаимодействия с Госключом (токены, ключи API, параметры соединений).
  - **structure.conf**: файл, описывающий структуру каталогов для хранения временных файлов, документов и архивов.
  - **logging.conf**: настройки логирования всех взаимодействий с системой и внешними сервисами.
- Структура каталогов:
  - **/var/www/goskey/logs/**: директория для хранения логов всех взаимодействий с Госключом, включая успешные и неуспешные запросы.
  - **/var/www/goskey/documents/**: здесь будут храниться все загруженные документы, разделенные по типам (входящие, исходящие, внутренние документы).
  - **/var/www/goskey/temp/**: временная папка для хранения промежуточных данных, таких как токены и временные файлы.
3. Перечень файлов скриптов с названиями
Для обеспечения работы системы будет использован набор скриптов, каждый из которых отвечает за выполнение определенной функции.
- **central_script.sh**: центральный управляющий скрипт, который управляет запуском всех остальных процессов, включая инициализацию, настройку конфигураций и контроль за выполнением других скриптов.
- **webhook_handler.sh**: скрипт для обработки входящих Webhook запросов от системы Госключ и Телеграм. Этот скрипт отвечает за получение сообщений, их обработку и передачу результатов обратно в систему.
- **document_processor.sh**: скрипт для обработки документов, отправляемых через Телеграм бот. Он отвечает за получение документов, их проверку, сохранение и регистрацию в системе.
- **error_handler.sh**: скрипт для обработки ошибок, возникающих во время работы. Обеспечивает уведомление ответственных лиц и запись ошибок в лог-файлы.
4. Центральный управляющий скрипт и компоненты для реализации Webhook
В системе необходимо предусмотреть наличие центрального управляющего скрипта, который будет координировать работу всех остальных скриптов и процессов. Этот скрипт должен обеспечивать:
- Запуск и остановку всех основных сервисов и процессов.
- Мониторинг работы других скриптов и компонентов системы, включая обработку ошибок и перезапуск в случае сбоев.
- Управление логированием и сбором метрик о работе системы.

Кроме того, в системе должны быть реализованы компоненты для обработки Webhook:
- Компоненты Webhook должны обеспечивать прием и обработку запросов от сторонних сервисов (например, Телеграм и Госключ).
- Важно предусмотреть масштабируемость компонентов Webhook для обработки большого количества запросов одновременно.
- Webhook должен корректно взаимодействовать с другими элементами системы, передавая полученные данные на дальнейшую обработку.

